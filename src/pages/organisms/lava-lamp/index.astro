---
import LayoutComponent from "../../../layouts/LayoutComponent.astro";
import LavaLamp from "./lava-lamp.astro";

import Column from "./svg/column.svg?raw";
import Plateau from "./svg/plateau.svg?raw";
import Wave from "./svg/wave.svg?raw";
import Eye from "./svg/eye.svg?raw";
---

<LayoutComponent title="test">
  <div class="section-lava-lamp">
    <div class="section-lava-lamp__container">
      <div class="section-lava-lamp__column section-lava-lamp__column--left" ><Fragment set:html={Column} /></div>
      <h1 class="section-lava-lamp__title">
        <span class="sm">The</span>
        <span class="md">Lava Lamp</span>
        <span class="sm">of</span>
        <span class="md">Mother fucker</span>
      </h1>
      <div class="section-lava-lamp__plateau"><Fragment set:html={Plateau} /></div>
      <div class="section-lava-lamp__eye">
         <div class="section-lava-lamp__eye-container"><div class="eye"><div class="pupil"></div></div></div>
         <Fragment set:html={Eye} />
      </div>
      <div class="section-lava-lamp__column section-lava-lamp__column--right"><Fragment set:html={Column} /></div>
    </div>
    <LavaLamp class="section-lava-lamp__background"/>
    <div class="section-lava-lamp__wave"><Fragment set:html={Wave} /></div>
  </div>
</LayoutComponent>

<script>
  // Find inspiration here: https://codepen.io/tag/eyes?cursor=ZD0xJm89MCZwPTM=
  // Use this solution: https://codepen.io/N0G4ME/pen/yLPVJzv

  //Define vars
  var pupilLeft;
  var pupilTop;

  //Get the eyewidth (parent div of the pupils)
  var eyeWidth = document.getElementsByClassName("eye")[0].offsetWidth;
  var eyeHeight = document.getElementsByClassName("eye")[0].offsetHeight;

  //Get the pupils
  var pupil1 = document.getElementsByClassName("pupil")[0];
  var pupil2 = document.getElementsByClassName("pupil")[1];
  var pupils = [pupil1, pupil2];
  //Get the pupils width and height
  var pupilWidth = document.getElementsByClassName("pupil")[0].offsetWidth;
  var pupilHeight = document.getElementsByClassName("pupil")[0].offsetHeight;

  //On mousemove execute MoveEyes
  document.addEventListener("mousemove", MoveEyes);

  //Make pupils follow the cursor
  function MoveEyes(event){
    //Get mouse positions
    var mouseX = (event.clientX / window.innerWidth) * 2 - 1;
    var mouseY = (event.clientY / window.innerHeight) * 2 - 1;
    
    //The standard offset (margins) for the pupils and keep the pupil in the eye
    var horizontalOffset = (eyeWidth - pupilWidth) - (pupilWidth/4); 
    var verticalOffset = (eyeHeight - pupilHeight) - (pupilHeight/4);
    
    //Calculate min and max that eye can move 
    pupilLeft = clamp(eyeWidth * mouseX, -horizontalOffset, horizontalOffset);
    pupilLeft = Math.floor(pupilLeft);
    pupilTop = clamp(eyeHeight * mouseY, -verticalOffset, verticalOffset);
    pupilTop = Math.floor(pupilTop);
    
    //Get all the pupils and change the margins
    pupils.forEach(pupil => {
      pupil.style.marginLeft = pupilLeft+"px";
      pupil.style.marginTop = pupilTop+"px";
      //Make sure width and height stay the same
      pupil.style.width = pupilWidth+"px";
      pupil.style.height = pupilHeight+"px";
    });
  }

  //Clamp between a min and max
  function clamp(x, a, b) {
    if (x < a) return a;
    if (x > b) return b;
    return x;
  }

</script>

<style lang="scss" is:global>
  @use "../../../scss/config" as *;
  @import url('https://fonts.googleapis.com/css2?family=Grenze:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Sora:wght@100..800&display=swap');

  // look here also: https://codepen.io/arindam404/pen/qBLVwPd
  .section-lava-lamp__eye{
    aspect-ratio: 195 / 111;
    // background: $black;
    width: rem(157);
    margin: 0 auto;
    margin-top: rem(-300);
    position: relative;
    
    &-container{
      // Mask
      aspect-ratio: 157 / 65;

      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate3d(-50%, -48%, 0);
      width: 80%;
      height: auto;
      mask-image: url("./svg/eye-mask.svg");
      mask-size: 100% 100%;
      mask-repeat: no-repeat;
      mask-position: center;

      // &:after{
      //   @include pseudo();
      //   @include center;
      //   @include square(50);
      //   border-radius: $radius-full;
      //   border: 2px solid $white;
      //   margin-top: rem(-10);
      // }
    }

  }
  
  /*Styling for an eye*/
  .eye{
    margin-top: rem(-5);
    @include center();
    width: rem(100);
    height: rem(100);
    background: transparent;
    border: 1.5px solid $white;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    overflow: hidden;

    // create a masl arround it;
  }

  .pupil{
    position: absolute;
    @include square(50);
    // background: $white;
    border: 1.5px solid $white;
    margin-left: 0;
    margin-top: 0;
    border-radius: rem(9999);
    &:after{
      @include pseudo();
      @include center();
      @include square(30);
      background: $white;
      border-radius: $radius-full;
    }
  }

  
  .section-lava-lamp{
    position: relative;
    // min-height: 100vh;
    // min-width: 100vw;
    width: 100%;
  
    font-family: "Grenze", serif;
    padding: 0 $gutter;

    // Layout
    &__container{
      position: relative;
      width: 100%;
      max-width: rem(1296);
      margin: 0 auto;
      z-index: 9;
      flex-direction: column;
      align-items: center;
      aspect-ratio: 1296 / 816;
    }
    &__plateau{
      width: rem(840);
      max-width: 64%;
      margin: 0 auto;
    }
    &__column{
      position: absolute;
      top: 0;
      margin-top: rem(100);
      max-width: 45%;
      
      &--left{
        left: 0;
      }
      &--right{
        right: 0;
        transform: scaleX(-1);
      }
    }
    &__background{
      position: absolute !important;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    &__wave{
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      z-index: 2;
    }

    // Elements
    &__title{
      padding-top: rem(88);
      padding-bottom: rem(30);
      color: $white;
      line-height: .82;
      text-transform: uppercase;
      font-weight: $fw-regular;
      text-align: center;
      font-size: rem(100);
      
      @media screen and (max-width: '1350px'){ // Breakpoint of column becoming smaller
        font-size: 7vw;
        padding-bottom: 3vw;
      }
      
      span{
        display: block;
      }

      .sm{
        font-weight: 100;
        font-size: rem(40);

        @media screen and (max-width: '1350px'){ // Breakpoint of column becoming smaller
          font-size: 3.5vw;
        }
      }
    }

    svg{
      height: auto;
      max-width: 100%;
    }
    
  }
</style>